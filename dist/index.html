<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Garage Database Interface</title>
  <!-- Favicon -->
  <link rel="icon" href="src/img/Garage.ico" type="image/x-icon" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <!-- Main css file -->
  <link rel="stylesheet" href="css/index.min.css" />
  <!-- Custom styles -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/plug-ins/1.10.11/sorting/date-eu.js"></script>



  <script src="https://cdn.datatables.net/buttons/2.3.5/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.5/js/buttons.html5.min.js"></script>






  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.1/purify.min.js"
    integrity="sha512-TU4FJi5o+epsahLtM9OFRvH2gXmmlzGlysk9wtTFgbYbMvFzh3Cw1l3ubnYIvBiZCC/aurRHS408TeEbcuOoyQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
    integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"
    integrity="sha512-03CCNkeosDFN2zCCu4vLpu3pJfZcrL48F3yB8k87ejT+OVMwco7IH3FW02vtbGhdncS6gyYZ/duYaC/K62xQPQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->




  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@animxyz/core">





  <style>
    .gradient-custom {
      /* fallback for old browsers */
      background: #a18cd1;

      /* Chrome 10-25, Safari 5.1-6 */
      background: -webkit-linear-gradient(45deg,
          rgba(29, 236, 197, 0.6),
          rgba(91, 14, 214, 0.6) 100%);

      /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
      background: linear-gradient(45deg,
          rgba(29, 236, 197, 0.6),
          rgba(91, 14, 214, 0.6) 100%);
    }

    #card-background {
      background: rgba(255, 255, 255, 0.55);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(3.5px);
      -webkit-backdrop-filter: blur(3.5px);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      max-width: 95vw;
      max-height: 95vh;
      overflow-y: auto;
    }

    .highlight-card {
      background: rgba(37, 37, 37, 0.05);
      box-shadow: 0 8px 32px 0 rgba(46, 48, 77, 0.001);
      border-radius: 15px;
      border: 1px solid rgba(232, 232, 232, 0.18);
      max-width: 95vw;
      max-height: 95vh;
      padding: 1rem;
      margin-top: 1rem;
      margin-bottom: 1rem;
    }

    .btn-primary {
      margin-bottom: 2rem;
    }

    .input-field {
      background: rgba(255, 255, 255, 0.55);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      border-radius: 5px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      font-size: 1.5rem;
      width: 100%;

    }

    .input-label {
      font-size: 1.5rem;
    }

    .table {
      width: 100%;
    }

    #big-loading-icon {
      width: 100%;
      display: flex;
      justify-content: center;
      position: absolute;
      top: 50%;
      z-index: 2
    }

    .badge-image {
      width: 10rem;
      height: 14rem;
      padding: 0.2rem;
      margin: auto;
    }

    #badge-carousel {
      max-height: 30rem;
      overflow-y: auto;
      padding: 0.5rem;
    }
  </style>
</head>

<body>
  <!-- Start your project here-->


  <div class="bg-image" style="
    background-image: url('../src/img/Background.jpg');
    height: 100vh;
  ">
    <div class="mask gradient-custom">
      <div class="d-flex justify-content-center align-items-center h-100">
        <div id="big-loading-icon" class="xyz-in" xyz="fade down stagger delay-8">
          <div class="spinner-grow" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>

        <div id="card-background" class="p-3 mb-2 text-dar xyz-in" xyz="fade down stagger delay-2">

          <div style="margin: 2rem;">
            <h1 class="xyz-in" xyz="fade down stagger delay-4">Garage Database</h1>
            <div id="main-row" class="row" xyz="fade small stagger ease-out-back delay-3">
              <div id="login-card" class="highlight-card xyz-nested" style="min-width: 18rem;">

                <label for="matric" class="input-label">Matric Number:</label><br />
                <input type="text" id="matric" name="matric" class="input-field"><br />
                <label for="passcode" class="input-label">Passcode (DD/MM):</label><br />
                <input type="password" id="passcode" name="passcode" class="input-field"><br />
                <br />
                <button type="button" onclick="getData(this)" class="btn btn-primary">
                  <span id="loading-icon" class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                  Search
                </button>
                <br />
              </div>

              <div style="width: 55%; min-width: 18rem;">
                <div id="badge-card" class="xyz-nested">
                  <div class="highlight-card">
                    <h4>Certificates</h4>
                    <div id="badge-carousel" class="row"></div>
                  </div>
                </div>

                <div id="position-label" class="xyz-nested">
                  <div class="highlight-card">
                    <h4>Position</h4>
                    <h3 id="position-output">
                      <h4>Inno Credits</h4>
                      <h3 id="points-output">
                  </div>
                </div>
              </div>


            </div>

            <div id="event-data" style="overflow-y:auto;" xyz="fade small stagger">

              <br />
              <h5 class="xyz-nested">
                You can access useful links and active projects <a href="linktr.ee/garage_tools"
                  target="_blank">here</a>, through the <b>Garage Ambassador HandbookðŸ“š</b>
              </h5>
              <br />
              <h5 class="xyz-nested">
                If there are any discrepancies or questions, please approach the steering committee. Their contact can
                be found inside the <b>Garage Ambassador HandbookðŸ“š</b>.
              </h5>
              <hr class="rounded xyz-nested">
              <h4>Event Data</h4>
              <table id="event-data-table" class="table table-striped xyz-nested">
                <thead>
                  <tr>
                    <th>Event Name</th>
                    <th>Event Date</th>
                    <th>Description</th>
                    <th>Event Position</th>
                    <th>Inno Credits</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
              <div id="editor"></div>
              <button type="button" onclick="
                table.button( '.buttons-pdf' ).trigger();" class="btn btn-primary">
                Download
              </button>
            </div>


          </div>

        </div>


      </div>
    </div>
    <!-- End your project here-->
</body>
<!-- Main js file -->
<script type="text/javascript" src="js/index.min.js"></script>
<!-- Custom scripts -->


</html>

<script type="text/javascript">

  var table;
  document.getElementById("login-card").style.width = "100%";
  var eventdata = document.getElementById("event-data");
  eventdata.style.display = "none";
  document.getElementById("position-label").style.display = "none";
  document.getElementById("badge-card").style.display = "none";
  document.getElementById("loading-icon").style.display = "none";
  document.getElementById("big-loading-icon").style.display = "none";
  var mainrow = document.getElementById("main-row");

  const input = document.querySelector("#passcode");
  input.addEventListener("keyup", (event) => {
    if (event.keyCode === 13) {
      getData()
    }
  });

  mainrow.style.display = "";
  mainrow.classList.add("xyz-in");


  $(document).ready(function () {
    table = $('#event-data-table').DataTable({
      ordering: true,
      info: true,
      stripe: true,
      autoWidth: false,
      "columnDefs": [{ "targets": 1, "type": "date-eu" }],
      buttons: [
        {
          extend: 'pdfHtml5',
          orientation: 'portrait',
          pageSize: 'A4'
        }
      ]


    });

    //t.row.add(['test1', 'test2', 'test3', 'test4']).draw(true);

  });

  // function downloadPDF() {
  //   var doc = new jsPDF('portrait', 'pt', 'a4');

  //   doc.autoTable({
  //     html: '#event-data-table',
  //     startY: 70,
  //     theme: 'grid',

  //   })
  //   doc.save("table.pdf");

  // }

  function getData() {
    var matric = document.getElementById("matric").value;
    var passcode = document.getElementById("passcode").value;

    if (matric == "") {
      alert("Please input a matric number!");
      return;
    }

    document.getElementById("loading-icon").style.display = "";
    document.getElementById("big-loading-icon").style.display = "flex";

    //alert(matric);
    mainrow.classList.remove("xyz-in");
    mainrow.classList.add("xyz-out");
    eventdata.classList.remove("xyz-in");
    eventdata.classList.add("xyz-out");

    //document.getElementById("event-data").style.display = "none";
    var endpoint = "https://script.google.com/macros/s/AKfycbxygzbFqiS9AU_cjlBK3GoUtSNnz3eYSg_mpuFDQfCcg91sPRFW7ELUsJSfeDMjW5hj/exec"
    var url = endpoint + "?Matric=" + matric + "&Passcode=" + passcode;

    fetch(url, { method: 'GET', redirect: 'follow' })
      .then((response) => response.json())
      .then((data) => {
        console.log(data);
        table.clear().draw();
        document.getElementById("position-label").style.display = "";
        document.getElementById('position-output').innerHTML = data['portfolio'];
        document.getElementById('points-output').innerHTML = data['total_points'];
        document.getElementById("badge-carousel").innerHTML = '';

        if (data['certificate_details'] !== undefined && data['certificate_details'].length != 0) {
          document.getElementById("badge-card").style.display = "";
          data['certificate_details'].forEach((badge, i) => {
            var div = document.getElementById('badge-carousel');

            div.innerHTML += '<div class="badge-image xyz-in"  xyz="fade small stagger ease-out-back delay-15"><img class="xyz-in" src="' + badge['certificate_badge_link'] + '" alt="Italian Trulli" style="max-width:100%;"> <h4 class="xyz-in" style="text-align: center;">' + badge['certificate_name'] + '</h4></div>';

          });
        }

        if (data['event_details'] !== undefined && data['event_details'].length != 0) {
          document.getElementById("event-data").style.display = "";
          data['event_details'].forEach((event, i) => {
            var parsedDate = new Date(Date.parse(event['event_date']));
            var formattedDate = parsedDate.toLocaleDateString('en-GB');
            table.row.add([event['event_name'], formattedDate, event['event_description'], event['event_position'], event['event_point']]).draw(false);
          });
        }



        document.getElementById("loading-icon").style.display = "none";
        document.getElementById("big-loading-icon").style.display = "none";
        mainrow.style.display = "";
        mainrow.classList.remove("xyz-out");
        mainrow.classList.add("xyz-in");
        eventdata.classList.remove("xyz-out");
        eventdata.classList.add("xyz-in");
        document.getElementById("login-card").style.width = "45%";

      }
      );

  }
</script>